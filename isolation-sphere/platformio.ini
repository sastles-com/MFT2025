; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = atoms3r_bno055

[env:atoms3r_bno055]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
; PlatformIO Project Configuration File
monitor_rts = 0
monitor_dtr = 0
upload_speed = 1500000
build_type = debug
build_flags = 
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D USE_FASTLED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-D IMU_SENSOR_BNO055
	-fpermissive
	-D ELEGANTOTA_USE_ASYNC_WEBSERVER=1
	-std=c++14
build_src_filter =
	+<*>
	-<test_strip/*>
	-<test_shake/*>
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
	adafruit/Adafruit BusIO@^1.16.1
	adafruit/Adafruit Unified Sensor@^1.1.14
	adafruit/Adafruit GFX Library@^1.11.10
	hpsaturn/EspNowCam@^0.1.14
	tobozo/ESP32-PSRamFS@^1.0.6
	bodmer/TJpg_Decoder
	marvinroger/AsyncMqttClient
	esp32async/ESPAsyncWebServer@^3.7.3
	esp32async/AsyncTCP@^3.4.8
	ayushsharma82/ElegantOTA@^3.1.2
	bblanchon/ArduinoJson@^6.21.3
	adafruit/Adafruit BNO055@^1.6.3
	throwtheswitch/Unity@^2.6.0
lib_ldf_mode = deep
test_build_src = no


[env:strip_demo]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
monitor_rts = 0
monitor_dtr = 0
; Use a lower upload speed for stability on some hosts/boards
upload_speed = 115200
build_type = debug
# Only compile the demo runner to avoid multiple setup()/loop() definitions
build_src_filter = +<test_strip/TestStripDemo.cpp> +<pattern/TestStripPattern.cpp>
build_flags = 
	-DTEST_STRIP_DATA_PIN=8
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-fpermissive
	-std=c++14
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
	adafruit/Adafruit BusIO@^1.16.1
	adafruit/Adafruit Unified Sensor@^1.1.14
	adafruit/Adafruit GFX Library@^1.11.10
	hpsaturn/EspNowCam@^0.1.14
	tobozo/ESP32-PSRamFS@^1.0.6
	bodmer/TJpg_Decoder
	marvinroger/AsyncMqttClient
	esp32async/ESPAsyncWebServer@^3.7.3
	esp32async/AsyncTCP@^3.4.8
	ayushsharma82/ElegantOTA@^3.1.2
	bblanchon/ArduinoJson@^6.21.3
	arduino-libraries/Madgwick@^1.2.0
	throwtheswitch/Unity@^2.6.0
lib_ldf_mode = deep
test_build_src = no

[env:test_strip_demo]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
monitor_rts = 0
monitor_dtr = 0
upload_speed = 1500000
build_type = debug
# Only compile the test runner(s) under src/test_strip to avoid multiple setup()/loop() definitions
build_src_filter = +<test_strip/TestStripDemo.cpp> +<pattern/TestStripPattern.cpp>
build_flags = 
	-DTEST_STRIP_DATA_PIN=8
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-fpermissive
	-std=c++14
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
	adafruit/Adafruit BusIO@^1.16.1
	adafruit/Adafruit Unified Sensor@^1.1.14
	adafruit/Adafruit GFX Library@^1.11.10
	hpsaturn/EspNowCam@^0.1.14
	tobozo/ESP32-PSRamFS@^1.0.6
	bodmer/TJpg_Decoder
	marvinroger/AsyncMqttClient
	esp32async/ESPAsyncWebServer@^3.7.3
	esp32async/AsyncTCP@^3.4.8
	ayushsharma82/ElegantOTA@^3.1.2
	bblanchon/ArduinoJson@^6.21.3
	arduino-libraries/Madgwick@^1.2.0
	throwtheswitch/Unity@^2.6.0
lib_ldf_mode = deep
test_build_src = no

[env:test_shake_demo]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
monitor_rts = 0
monitor_dtr = 0
upload_speed = 115200
build_type = debug
# Only compile the shake demo runner and the ShakeDetector implementation
build_src_filter = +<test_shake/TestShakeDemo.cpp> +<imu/ShakeDetector.cpp>
build_flags = 
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-fpermissive
	-std=c++14
lib_deps = 
	# Minimal dependencies for shake demo to avoid heavy global init (M5Unified/M5GFX removed)
	# Keep SPI/Wire off unless needed by the demo to prevent library global constructors.

lib_ldf_mode = deep
test_build_src = no

[env:unit_native]
platform = native
build_type = debug
test_build_src = yes
board = native
lib_deps = throwtheswitch/Unity, bblanchon/ArduinoJson@^6.21.3
; Include our unit tests and minimal bridge implementations
build_src_filter = +<test/test_shake_to_ui/*> +<test/test_procedural_opening_player/*> +<test/test_procedural_opening_leds/*> +<test/test_config_led/*> +<test/test_config_full/*> +<test/test_ledsphere_manager/*> +<include/imu/ShakeToUiBridge.h> +<src/imu/ShakeToUiBridge.cpp> +<src/boot/ProceduralOpeningPlayer.cpp>

[env:atoms3r_bmi270]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
monitor_rts = 0
monitor_dtr = 0
; Use a lower upload speed for stability on some hosts/boards
upload_speed = 115200
build_type = debug
build_flags = 
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D USE_FASTLED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-D IMU_SENSOR_BMI270
	-fpermissive
	-D ELEGANTOTA_USE_ASYNC_WEBSERVER=1
	-std=c++14
; Only include production sources; explicitly exclude test/demo runners that define setup()/loop()
build_src_filter =
	+<*>
	+<test/ProceduralPatternPerformanceTest.cpp>
	-<test_shake/*>
	-<main.cpp>
	-<cube_neon_led_demo.cpp>
	-<simple_led_demo.cpp>
	-<strip_test_demo.cpp>
	-<cube_neon_demo_standalone.cpp>
	-<test_strip/*>
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
	adafruit/Adafruit BusIO@^1.16.1
	adafruit/Adafruit Unified Sensor@^1.1.14
	adafruit/Adafruit GFX Library@^1.11.10
	hpsaturn/EspNowCam@^0.1.14
	tobozo/ESP32-PSRamFS@^1.0.6
	bodmer/TJpg_Decoder
	marvinroger/AsyncMqttClient
	esp32async/ESPAsyncWebServer@^3.7.3
	esp32async/AsyncTCP@^3.4.8
	ayushsharma82/ElegantOTA@^3.1.2
	bblanchon/ArduinoJson@^6.21.3
	arduino-libraries/Madgwick@^1.2.0
	throwtheswitch/Unity@^2.6.0
	file://../lib/common  # 共通ライブラリ参照
lib_ldf_mode = deep
test_build_src = no
 

; [env:test_strip]
; extends = atoms3r_bmi270
; src_dir = src/test_strip

; CUBE-neon統合デモ環境
[env:cube_neon_demo]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
upload_speed = 1500000
build_type = debug
build_flags = 
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D USE_FASTLED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-D IMU_SENSOR_BMI270
	-D CUBE_NEON_DEMO
	-D USE_FAST_MATH
	-fpermissive
	-std=c++14
build_src_filter = 
	-<*>
	+<cube_neon_demo_standalone.cpp>
	+<math/>
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
	adafruit/Adafruit BusIO@^1.16.1
	adafruit/Adafruit Unified Sensor@^1.1.14
	file://../lib/common
lib_ldf_mode = deep

; シンプルCUBE-neon LED表示デモ環境
[env:simple_led_demo]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
upload_speed = 1500000
build_type = debug
build_flags = 
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D USE_FASTLED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-D IMU_SENSOR_BMI270
	-D SIMPLE_LED_DEMO
	-D USE_FAST_MATH
	-fpermissive
	-std=c++14
build_src_filter = 
	-<*>
	+<simple_led_demo.cpp>
	+<math/>
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
lib_ldf_mode = deep

; ストリップテストデモ環境（4ストリップLED動作確認）
[env:strip_test_demo]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
upload_speed = 1500000
build_type = debug
build_flags = 
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D USE_FASTLED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-D STRIP_TEST_DEMO
	-fpermissive
	-std=c++14
build_src_filter = 
	-<*>
	+<strip_test_demo.cpp>
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
lib_ldf_mode = deep

; CUBE-neon LED表示統合デモ環境
[env:cube_neon_led_demo]
platform = espressif32@^6.8.1
platform_packages = 
	platformio/framework-arduinoespressif32@^3.20017.0
	platformio/tool-esptoolpy@1.40501.0
framework = arduino
board = m5stack-atoms3
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
upload_speed = 1500000
build_type = debug
build_flags = 
	-D ARDUINO_USB_CDC_ON_BOOT=1
	-D ESP32S3
	-D ARUDINO_M5STACK_ATOMS3R
	-D BOARD_HAS_PSRAM
	-D USE_M5UNIFIED
	-D USE_FASTLED
	-D CORE_DEBUG_LEVEL=4
	-D DEBUG
	-D IMU_SENSOR_BMI270
	-D CUBE_NEON_LED_DEMO
	-D USE_FAST_MATH
	-fpermissive
	-std=c++14
build_src_filter = 
	-<*>
	+<cube_neon_led_demo.cpp>
	+<math/>
lib_deps = 
	SPI
	Wire
	m5stack/M5Unified
	m5stack/M5GFX
	fastled/FastLED
lib_ldf_mode = deep
